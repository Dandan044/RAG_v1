# 改进“人物记录者”与界面交互的实施计划

## 1. 数据结构升级 (Type Definitions)
首先需要扩展人物的数据模型，以支持主角标识和精细化的身体部位状态追踪。

*   **修改 `src/types/index.ts`**:
    *   新增 `BodyPartStatus` 接口，包含部位名称、状态描述、严重程度 (`low` | `medium` | `high` | `critical`) 和最后更新轮次。
    *   在 `CharacterProfile` 接口中增加:
        *   `isProtagonist`: boolean (是否为主角)
        *   `bodyStatus`: Record<string, BodyPartStatus> (身体部位状态映射)

## 2. 智能体逻辑增强 (Agent Logic)
更新“人物记录者”的系统提示词（System Prompt）和处理逻辑，使其具备上下文感知和自动治愈判断能力。

*   **修改 `src/store/agentConfigStore.ts`**:
    *   更新 `character_recorder` 的 prompt：
        *   **主角锚定**: 明确指令要求识别唯一的“主角”向量，能够将第一人称（“我”）、第二人称（“你”）或特定名字映射到同一个主角档案。
        *   **部位追踪**: 仅针对主角，要求记录特定部位（左臂、右臂、左腿、右腿、头部、躯干等）的状态。
        *   **状态过滤**: 增加过滤规则，忽略鸡毛蒜皮的小伤（如擦伤、呛咳），仅记录影响剧情的状态（如骨折、中毒）。
        *   **自动治愈**: 增加逻辑判断指令——如果伤势轻微且文中未提及或时间流逝，视为好转；如果经过治疗，视为痊愈；重伤需明确剧情解决。
*   **修改 `src/api/analyzers.ts`**:
    *   更新 `analyzeCharacters` 函数的数据解析逻辑，确保 `bodyStatus` 和 `isProtagonist` 字段能被正确解析和合并。
    *   更新向量存储逻辑，将主角的身体状态摘要写入向量库，以便后续检索。

## 3. 前端界面改造 (UI/UX)
实现右侧面板的折叠功能，并新增人体状态可视化视图。

*   **新增 `src/components/BodyStatusView.tsx`**:
    *   创建一个可视化组件，使用 SVG 或 CSS 布局展示人体轮廓。
    *   根据主角的 `bodyStatus` 数据，在对应部位显示高亮（如红色表示受伤）和状态标签。
    *   支持悬停查看详细伤情。
*   **修改 `src/pages/NovelWorkshopPage.tsx`**:
    *   **右侧面板折叠**:
        *   添加 `isRightPanelOpen` 状态。
        *   将右侧面板改为可折叠样式（默认收起）。
        *   添加侧边悬浮按钮或顶部切换按钮来控制面板展开/收起。
    *   **集成人体视图**:
        *   在右侧面板中（专家列表上方或作为独立Tab）嵌入 `BodyStatusView`。
        *   自动从 `novelSession.characters` 中筛选出 `isProtagonist: true` 的角色数据传递给组件。

## 4. 验证计划
*   **模拟测试**: 编写一段包含“我摔断了左手”的剧情，检查是否生成了包含 `leftArm: broken` 的主角档案。
*   **治愈测试**: 模拟后续剧情“过了三天”，检查状态是否自动更新为“正在愈合”或消失。
*   **UI测试**: 点击右侧折叠按钮，确认动画流畅且人体视图渲染正确。

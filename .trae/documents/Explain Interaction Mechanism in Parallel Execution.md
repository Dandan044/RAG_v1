# 大纲讨论阶段的专家交互机制说明

您关注的问题非常关键：在并发执行模式下，如何确保专家之间能够相互参考意见？

## 现有机制分析
在并发模式下，专家间的交互逻辑如下：

1.  **轮次间交互 (Inter-round Reference)**：
    *   **第1轮 (Round 1)**：所有专家基于初始需求和世界观同时发言。此时他们**看不到**彼此正在生成的观点（因为是并发的），这保证了观点的**多样性**和**独立性**，类似于“头脑风暴”阶段。
    *   **第2轮 (Round 2)**：所有专家依然同时发言，**但**他们的输入 Prompt 中包含了**第1轮所有专家的完整发言记录** (`discussionLog`)。此时，他们的任务不再是单纯提出新观点，而是基于第1轮的讨论进行**整合、修正或反驳**。

2.  **代码实现确认**：
    在 `useDiscussionStore.ts` 中，我们维护了一个 `discussionLog` 变量：
    ```typescript
    // 每次循环（轮次）结束后更新 discussionLog
    roundResults.forEach(({ expert, content }) => {
        discussionLog += `${expert.name} (${expert.field}): ${content}\n\n`;
    });
    // 下一轮循环时，generateOutlineContribution 会传入最新的 discussionLog
    ```

## 改进计划：强化第2轮的“参考”指令

为了确保第2轮专家**显式地**参考第1轮的意见，而不仅仅是“看到”了，我建议微调 `generateOutlineContribution` 的 Prompt 逻辑（位于 `src/api/deepseek.ts`），虽然本次任务不强制修改 Prompt，但这是让并发模式效果更好的关键。

**目前的交互流程是合理的**：
- **Round 1**: 独立思考，百花齐放。
- **Round 2**: 统筹全局，去粗取精。

如果您希望专家在**同一轮**内也能实时参考（例如专家B必须等专家A说完），那就必须牺牲并发性能退回到串行模式。但在大纲创作场景下，**轮次间交互**通常能取得更好的平衡：既保留了高效率，又实现了观点的碰撞与融合。

## 结论
当前的并发设计通过**多轮次迭代**来实现意见参考。专家们在下一轮会“听到”上一轮所有人的发言。这是一种在分布式系统和高效会议中常见的**异步协同**模式。
